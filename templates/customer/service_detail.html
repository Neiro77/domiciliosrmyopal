{% extends 'base.html' %}

{% block title %}{{ service.name }} - RM Domicilios{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="bg-white rounded-lg shadow-lg mb-8 overflow-hidden animate-fade-in-up">
        <div class="relative">
            <img src="{{ url_for('static', filename='img/' + service.image) }}" alt="{{ service.name }}" class="w-full h-64 object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
            <div class="absolute bottom-0 left-0 p-6 text-white">
                <h1 class="text-4xl font-bold mb-2">{{ service.name }}</h1>
                <p class="text-lg mb-2">{{ service.type }} &bull; {{ service.cuisine }}</p>
                <div class="flex items-center text-yellow-400 text-sm">
                    <i class="fas fa-star mr-1"></i> {{ service.rating }} ({{ service.reviews }} reseñas)
                </div>
            </div>
        </div>
        <div class="p-6 flex flex-col md:flex-row justify-between items-start md:items-center text-gray-700 text-sm">
            <div class="mb-4 md:mb-0">
                <p class="mb-1"><i class="fas fa-map-marker-alt mr-2"></i>Calle 123 #45-67, Yopal</p> {# Simular dirección #}
                <p class="mb-1"><i class="fas fa-clock mr-2"></i>Horario: 9:00 AM - 9:00 PM</p>
                <p><i class="fas fa-phone mr-2"></i>{{ service.phone if service.phone else 'N/A' }}</p>
            </div>
            <div class="text-right">
                <p class="mb-1">Tiempo de entrega: <span class="font-semibold">{{ service.delivery_time }}</span></p>
                <p class="mb-1">Costo de envío: <span class="font-semibold">${{ '{:,.0f}'.format(service.delivery_fee) }}</span></p>
                <p>Pedido Mínimo: <span class="font-semibold">${{ '{:,.0f}'.format(service.min_order) }}</span></p>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2">
            <h2 class="text-2xl font-bold text-gray-800 mb-5 animate-fade-in-up delay-200">Nuestro Menú / Servicios</h2>
            
            <div class="flex overflow-x-auto space-x-4 pb-4 mb-6 sticky top-[96px] bg-white z-20 border-b border-gray-200 -mx-4 px-4 lg:mx-0 lg:px-0">
                <a href="#category-all" class="px-5 py-2 rounded-full text-blue-600 bg-blue-50 font-semibold whitespace-nowrap hover:bg-blue-100 transition">Todos</a>
                {% for product in service.products %} {# Esto es un mockup, en real filtrarías por category #}
                    <a href="#category-{{ product.id }}" class="px-5 py-2 rounded-full text-gray-600 bg-gray-100 font-semibold whitespace-nowrap hover:bg-gray-200 transition">{{ product.name | truncate(15, true, '...') }}</a>
                {% endfor %}
                {# Deberías tener una lista de categorías de servicio aquí #}
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% for product in service.products %}
                <div id="category-{{ product.id }}" class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 flex items-center p-4 animate-fade-in-up delay-{{ loop.index * 100 }}">
                    <img src="{{ url_for('static', filename='img/' + product.image) }}" alt="{{ product.name }}" class="w-24 h-24 object-cover rounded-md mr-4 flex-shrink-0">
                    <div class="flex-grow">
                        <h3 class="text-lg font-semibold text-gray-900 mb-1">{{ product.name }}</h3>
                        <p class="text-gray-600 text-sm mb-2 line-clamp-2">{{ product.description }}</p>
                        <p class="text-xl font-bold text-gray-900">${{ '{:,.0f}'.format(product.price) }}</p>
                    </div>
                    <button class="bg-blue-600 text-white rounded-full p-2 ml-4 flex-shrink-0 hover:bg-blue-700 transition">
                        <i class="fas fa-plus text-lg"></i>
                    </button>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="lg:sticky lg:top-[96px] lg:h-[calc(100vh-120px)] self-start bg-white p-6 rounded-lg shadow-lg animate-fade-in-up delay-400">
            <h2 class="text-2xl font-bold text-gray-800 mb-5">Tu Pedido</h2>
            {% if cart_items %}
            <div class="space-y-4 mb-6 border-b border-gray-200 pb-4">
                {% for item in cart_items %}
                <div class="flex justify-between items-center">
                    <div>
                        <p class="font-semibold text-gray-800">{{ item.name }}</p>
                        <p class="text-gray-600 text-sm">Cantidad: {{ item.quantity }}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <p class="font-semibold text-gray-800">${{ '{:,.0f}'.format(item.price * item.quantity) }}</p>
                        <button class="text-red-500 hover:text-red-700"><i class="fas fa-trash-alt text-sm"></i></button>
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="space-y-2 mb-6">
                <div class="flex justify-between text-gray-700">
                    <span>Subtotal:</span>
                    <span>${{ '{:,.0f}'.format(cart_subtotal) }}</span>
                </div>
                <div class="flex justify-between text-gray-700">
                    <span>Costo de envío:</span>
                    <span>${{ '{:,.0f}'.format(cart_delivery_fee) }}</span>
                </div>
                <div class="flex justify-between font-bold text-lg text-gray-900 border-t border-gray-300 pt-3 mt-3">
                    <span>Total:</span>
                    <span>${{ '{:,.0f}'.format(cart_total) }}</span>
                </div>
            </div>

            <a href="{{ url_for('customer.checkout') }}" class="block w-full text-center bg-blue-600 text-white py-3 rounded-lg font-semibold text-lg hover:bg-blue-700 transition shadow-lg">
                Ir a Pagar
            </a>
            {% else %}
            <div class="text-center py-6 text-gray-600">
                <i class="fas fa-shopping-cart text-4xl mb-3 text-gray-400"></i>
                <p>Tu carrito está vacío. ¡Añade algunos ítems!</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}