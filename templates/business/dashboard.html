{% extends 'base.html' %}

{% block title %}Dashboard de Negocio{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-4xl font-extrabold text-gray-800 mb-6 text-center">Dashboard de {{ business_profile.name }}</h1>
    <p class="text-lg text-gray-600 text-center mb-10">Gestiona tus pedidos y tu negocio.</p>

    <div class="bg-white rounded-lg shadow-xl p-6 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Pedidos Recibidos</h2>

        {% if orders %}
            <div class="space-y-6">
                {% for order in orders %}
                <div class="border border-gray-200 rounded-lg shadow-sm p-4">
                    <div class="flex justify-between items-center mb-3">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800">Pedido #{{ order.id }}</h3>
                            <p class="text-gray-600 text-sm">Cliente: <span class="font-medium">{{ order.user.email }}</span></p>
                            <p class="text-gray-600 text-sm">Fecha: {{ moment(order.order_date).format('LLL') }}</p>
                        </div>
                        <div class="text-right">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium                               
                                    {% elif order.status == 'Pendiente' %}bg-yellow-100 text-yellow-800                                    
                                    {% elif order.status == 'Aceptado' %}bg-blue-100 text-blue-800
                                    {% elif order.status == 'En Preparacion' %}bg-purple-100 text-purple-800
									{% elif order.status == 'Cancelado' %}bg-red-100 text-red-800
                                    {% else %}bg-gray-100 text-gray-800{% endif %}">
                                <i class="fas fa-circle text-xs mr-2"></i> {{ order.status }}
                            </span>
                            <p class="text-2xl font-bold text-blue-600 mt-1">${{ "%.2f" | format(order.total_amount) }}</p>
                        </div>
                    </div>

                    <div class="mb-3">
                        <h4 class="font-semibold text-gray-700 mb-1">Detalles del Pedido:</h4>
                        <ul class="list-disc list-inside text-gray-600 space-y-0.5">
                            {% for item in order.items %}
                                <li>{{ item.quantity }} x {{ item.product.name if item.product else 'Ítem desconocido' }} (${{ "%.2f" | format(item.price_at_order) }} c/u)</li>
                            {% endfor %}
                        </ul>
                    </div>

                    <p class="text-gray-700 text-sm mb-3">Dirección de Entrega: {{ order.delivery_address }}</p>
                    {% if order.notes %}
                        <p class="text-gray-700 text-sm mb-4">Notas: {{ order.notes }}</p>
                    {% endif %}

                    {# Formulario para actualizar el estado del pedido #}
                    <form action="{{ url_for('business.update_order_status', order_id=order.id) }}" method="POST" class="flex flex-col sm:flex-row items-center space-y-3 sm:space-y-0 sm:space-x-3 mt-4">
                        {{ form.csrf_token() }}
                        <label for="status-{{ order.id }}" class="text-gray-700 font-medium">Cambiar estado a:</label>
                        <select name="new_status" id="status-{{ order.id }}" 
                                class="flex-grow w-full sm:w-auto px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            {% for status_option in business_statuses %}
							  <option value="{{ status_option }}"
								{% if order.status == status_option %}selected{% endif %}>
								{{ status_option }}
							  </option>
							{% endfor %}
                        </select>
                        <button type="submit" 
                                class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300">
                            Actualizar
                        </button>
                    </form>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center text-gray-600 text-lg py-12 border border-dashed border-gray-300 rounded-lg">
                <i class="fas fa-box-open text-6xl text-gray-400 mb-4"></i>
                <p>No tienes pedidos recibidos en este momento.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
