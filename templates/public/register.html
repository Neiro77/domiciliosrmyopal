{% extends 'base.html' %}

{% block title %}Regístrate - Domicilios RM{% endblock %}

{% block content %}
<div class="flex items-center justify-center min-h-[calc(100vh-160px)] px-4 py-8">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl border border-gray-200"
         x-data="{ userRole: '{{ form.role.data or 'customer' }}' }">
        
        <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Crea tu Cuenta</h2>
        <p class="text-center text-gray-600 mb-6">Elige cómo quieres unirte a Domicilios RM.</p>

        <!-- Selector de Rol Interactivo -->
        <div class="mb-6">
            <label class="block text-gray-700 text-sm font-semibold mb-3">Quiero registrarme como:</label>
            <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 justify-center">
                <button type="button" @click="userRole = 'customer'"
                        :class="{'bg-blue-600 text-white': userRole === 'customer', 'bg-gray-100 text-gray-800 hover:bg-gray-200': userRole !== 'customer'}"
                        class="flex-1 px-6 py-3 rounded-lg font-semibold transition duration-300 shadow-md text-center">
                    <i class="fas fa-user mr-2"></i> Cliente
                </button>
                <button type="button" @click="userRole = 'business'"
                        :class="{'bg-blue-600 text-white': userRole === 'business', 'bg-gray-100 text-gray-800 hover:bg-gray-200': userRole !== 'business'}"
                        class="flex-1 px-6 py-3 rounded-lg font-semibold transition duration-300 shadow-md text-center">
                    <i class="fas fa-store mr-2"></i> Negocio
                </button>
                <button type="button" @click="userRole = 'driver'"
                        :class="{'bg-blue-600 text-white': userRole === 'driver', 'bg-gray-100 text-gray-800 hover:bg-gray-200': userRole !== 'driver'}"
                        class="flex-1 px-6 py-3 rounded-lg font-semibold transition duration-300 shadow-md text-center">
                    <i class="fas fa-motorcycle mr-2"></i> Conductor
                </button>
            </div>
        </div>

        <!-- Formulario Principal -->
        <form action="{{ url_for('public.register') }}" method="POST">
            {{ form.csrf_token }}
            
            <!-- Input oculto que se actualiza con Alpine.js -->
            <input type="hidden" name="role" x-model="userRole">
            
            <!-- Campos Comunes -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="{{ form.first_name.id }}" class="block text-gray-700 text-sm font-semibold mb-2">{{ form.first_name.label }}</label>
                    {{ form.first_name(class="w-full px-4 py-3 border border-gray-300 rounded-lg ...") }}
                </div>
                <div>
                    <label for="{{ form.last_name.id }}" class="block text-gray-700 text-sm font-semibold mb-2">{{ form.last_name.label }}</label>
                    {{ form.last_name(class="w-full px-4 py-3 border border-gray-300 rounded-lg ...") }}
                </div>
            </div>
            <!-- ... (resto de campos comunes: email, phone_number, password, confirm_password) ... -->

            <!-- Campos para Conductores (Condicional) -->
            <div x-show="userRole === 'driver'" x-cloak class="mt-4 border-t pt-4">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Información del Vehículo</h3>
                <!-- ... (campos vehicle_type y license_plate) ... -->
            </div>

            <!-- Campos para Negocios (Condicional) -->
            <div x-show="userRole === 'business'" x-cloak class="mt-4 border-t pt-4">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Información del Negocio</h3>
                <!-- ... (campos business_name, business_address, business_description) ... -->
            </div>
            
            <button type="submit" class="w-full mt-6 bg-blue-600 text-white py-3 rounded-lg ...">
                Crear mi Cuenta
            </button>
        </form>

        <p class="text-center text-gray-600 mt-6">
            ¿Ya tienes una cuenta? <a href="{{ url_for('public.login') }}" class="text-blue-600 hover:underline font-semibold">Inicia Sesión</a>
        </p>
    </div>
</div>
{% endblock %}
